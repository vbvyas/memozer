extends layout

block content
  - var action = '/contacts'
  - action += contact.isNew? '' : '/' + contact.twitterUsername
  
  br
  form(role='form', method='post', action=action)
    input(type="hidden", name="_csrf", value="#{csrf_token}")
    input(type="hidden", name="profileImageUrl", value="#{contact.profileImageUrl}")    
    
    - if (!contact.isNew)
      input(type="hidden", name="_method", value="PUT")
          
    fieldset
      legend Editing "
        span.text-info #{contact.name}
        | "
      
      div.form-group
        label(for='name') Name
        input.form-control#name(name='name', value=contact.name)
        
      div.form-group
        label(for='twitterUsername') Twitter Username
        div.input-group
          span.input-group-addon @      
          input.form-control#twitterUsername(name='twitterUsername', value=contact.twitterUsername, readonly)
          
      div.form-group
        label(for='memo') Memo
        textarea.form-control#memo(name='memo') #{contact.memo}
        
      div.form-group
        label(for='tags') Tags (comma separated)
        //br
        input.form-control#tags(name='tags', value=contact.tags)
        //input.form-control#tags(name='tags', value=contact.tags, data-role='tagsinput')

      div.form-group
        label(for='connectionLocation.name') Location name
        input.form-control#connectionLocationName(name='connectionLocation.name')

      div.form-group
        input#lat(type='hidden', name='connectionLocation.lat')
        input#lng(type='hidden', name='connectionLocation.lng')
        a.btn.btn-danger#location(href='#')
          span.glyphicon.glyphicon-map-marker
          span#inner(style='padding-left: 0.5em') Get location
        
      div.form-group
        a.btn.btn-default(href='/') Cancel
        | &nbsp; &nbsp;
        button.btn.btn-primary(type='submit') Submit
  
  script.
    $('a#location').click(function() {
      if (navigator.geolocation){
        $('a#location').removeClass('btn-danger').addClass('btn-success');
        $('span#inner').html('Location acquired');
        navigator.geolocation.getCurrentPosition(function (position){
          $('input#lat').val(position.coords.latitude);
          $('input#lng').val(position.coords.longitude);
        });
      } else {
        $('span#inner').html('Unable to locate');
      }
    });
